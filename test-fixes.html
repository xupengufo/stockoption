<!DOCTYPE html>
<html>
<head>
    <title>æœŸæƒæƒåˆ©é‡‘ä¿®å¤æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .premium { font-weight: bold; color: #008000; }
        .strike { font-weight: bold; color: #0066cc; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ”§ æœŸæƒæƒåˆ©é‡‘ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-case">
        <h3>æµ‹è¯•1: AAPL ç°é‡‘æ‹…ä¿çœ‹è·ŒæœŸæƒ</h3>
        <button onclick="testStock('AAPL', 'cash-secured-put')">æµ‹è¯•AAPL</button>
        <div id="result-aapl-put" class="result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯•2: TSLA å¤‡å…‘çœ‹æ¶¨æœŸæƒ</h3>
        <button onclick="testStock('TSLA', 'covered-call')">æµ‹è¯•TSLA</button>
        <div id="result-tsla-call" class="result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯•3: NIO (ä¸­æ¦‚è‚¡) ç°é‡‘æ‹…ä¿çœ‹è·Œ</h3>
        <button onclick="testStock('NIO', 'cash-secured-put')">æµ‹è¯•NIO</button>
        <div id="result-nio-put" class="result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯•4: DPSP (å°ä»·è‚¡) ç°é‡‘æ‹…ä¿çœ‹è·Œ</h3>
        <button onclick="testStock('DPSP', 'cash-secured-put')">æµ‹è¯•DPSP</button>
        <div id="result-dpsp-put" class="result"></div>
    </div>

    <div class="test-case">
        <h3>æµ‹è¯•5: TEM (ç¤ºä¾‹è‚¡ç¥¨) å¤‡å…‘çœ‹æ¶¨</h3>
        <button onclick="testStock('TEM', 'covered-call')">æµ‹è¯•TEM</button>
        <div id="result-tem-call" class="result"></div>
    </div>

    <script>
        async function testStock(symbol, strategy) {
            const resultId = `result-${symbol.toLowerCase()}-${strategy.replace('-', '')}`;
            const resultDiv = document.getElementById(resultId);
            
            resultDiv.innerHTML = `<p>ğŸ”„ æ­£åœ¨æµ‹è¯• ${symbol} ${strategy}...</p>`;
            
            try {
                const response = await fetch('/api/analyze-v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbol: symbol,
                        strategy: strategy,
                        riskTolerance: 'moderate'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                let html = `
                    <h4>âœ… ${symbol} æµ‹è¯•æˆåŠŸ</h4>
                    <p><strong>å½“å‰è‚¡ä»·:</strong> $${data.currentPrice}</p>
                    <p><strong>æ•°æ®æº:</strong> ${data.stockData?.dataSource || 'Unknown'}</p>
                    <p><strong>æ¨èæœŸæƒæ•°é‡:</strong> ${data.recommendations.length}</p>
                    <h5>å‰3ä¸ªæ¨è:</h5>
                `;

                data.recommendations.slice(0, 3).forEach((rec, index) => {
                    html += `
                        <div style="margin: 8px 0; padding: 8px; background: white; border-left: 3px solid #4CAF50;">
                            <strong>${index + 1}.</strong> 
                            <span class="strike">$${rec.strike}</span> ${rec.type} 
                            | æƒåˆ©é‡‘: <span class="premium">$${rec.premium}</span>
                            | ä¹°ä»·: $${rec.bid || 'N/A'} | å–ä»·: $${rec.ask || 'N/A'}
                            | æˆäº¤é‡: ${rec.volume || 0} | æ¦‚ç‡: ${(rec.probability * 100).toFixed(1)}%
                            | æ•°æ®æº: ${rec.dataSource || 'Unknown'}
                        </div>
                    `;
                });

                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                    <p style="color: red;"><strong>é”™è¯¯:</strong> ${error.message}</p>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            document.body.insertAdjacentHTML('afterbegin', `
                <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3>ğŸ¯ ä¿®å¤éªŒè¯ç›®æ ‡</h3>
                    <ul>
                        <li>âœ… æƒåˆ©é‡‘ä¸å†æ˜¾ç¤ºä¸º0</li>
                        <li>âœ… è¡Œæƒä»·åŸºäºçœŸå®è‚¡ä»·è®¡ç®—</li>
                        <li>âœ… æ”¯æŒå¤šç§è‚¡ç¥¨ï¼ˆå¤§ç›˜è‚¡ã€ä¸­æ¦‚è‚¡ã€å°ä»·è‚¡ï¼‰</li>
                        <li>âœ… æ˜¾ç¤ºè¯¦ç»†çš„æœŸæƒå‚æ•°ï¼ˆä¹°å–ä»·ã€æˆäº¤é‡ç­‰ï¼‰</li>
                        <li>âœ… æ ‡æ˜æ•°æ®æ¥æº</li>
                    </ul>
                </div>
            `);
        };
    </script>
</body>
</html>